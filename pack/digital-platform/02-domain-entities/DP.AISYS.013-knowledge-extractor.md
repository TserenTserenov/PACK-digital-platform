---
id: DP.AISYS.013
name: Знание-Экстрактор
type: ai-system-passport
status: draft
summary: "Prompt-based ИИ-система экстракции знаний из сессий в Pack-совместимые сущности"
created: 2026-02-10
trust:
  F: 3
  G: domain
  R: 0.5
epistemic_stage: emerging
orientation: system
initiative: both
interface: both
related:
  uses: [DP.M.001]
  produces: [DP.WP.001]
---

# Знание-Экстрактор (Knowledge Extractor)

## 1. Определение

**Знание-Экстрактор** — ИИ-система, которая трансформирует информацию (гайды, посты, заметки сессий, переписки) в формализованные Pack-совместимые материалы и размещает их в нужных репозиториях.

> Знание ≠ Информация (DP.D.012). Экстрактор превращает информацию в знание.

## 2. Классификация

| Характеристика | Значение | Пояснение |
|----------------|----------|-----------|
| **Ориентация** | system | Работает с репозиториями, а не напрямую с человеком |
| **Инициатива** | both | Вызывается по команде (session-capture) или по расписанию (audit) |
| **Интерфейс** | both | Через API (программно) и через диалог (в сессии Claude Code) |

## 3. IPO-паттерн

### 3.1. Входы (Inputs)

| Вход | Источник | Тип |
|------|----------|-----|
| Сырая информация | Заметки сессии, гайды, посты, переписки | Текст |
| Манифесты Pack'ов | `00-pack-manifest.md` каждого Pack-репо | Структура |
| Правила экстракции | CLAUDE.md репозиториев, bounded contexts | Конфигурация |
| Список репо пользователя | MCP Registry + user-repos | Конфигурация |

### 3.2. Обработка (Processing)

1. **Классификация** — определение типа знания:
   - Доменное знание → Pack
   - Правило для всех репо → корневой CLAUDE.md
   - Правило для одного репо → CLAUDE.md конкретного репо
   - Метод / failure mode → соответствующий раздел Pack
   - Различение → 01B-distinctions.md

2. **Маршрутизация** — определение целевого репозитория и директории:
   - Проверка bounded context каждого Pack'а
   - Выбор наиболее подходящего Pack'а по scope
   - Определение директории внутри Pack'а (02-domain-entities, 03-methods, ...)

3. **Формализация** — трансформация в Pack-совместимый формат:
   - Добавление frontmatter (id, type, status, trust)
   - Структурирование по шаблону SPF (method card, WP card, FM card, ...)
   - Проверка на дидактику (SPF ban: no "step", "lesson")
   - Проверка различений (не путает ли метод с инструментом и т.д.)

4. **Валидация** — проверка перед предложением:
   - Соответствие bounded context
   - Отсутствие дубликатов (проверка по id и содержанию)
   - Process lint (из SPF)

### 3.3. Выходы (Outputs)

| Выход | Формат | Получатель |
|-------|--------|------------|
| Отчёт экстракции | Список кандидатов с классификацией ([DP.WP.001](../04-work-products/DP.WP.001-extraction-report.md)) | Человек (на ревью) |
| Pack-совместимые сущности | Markdown-файлы с frontmatter | Pack-репозитории (после одобрения) |
| Commit proposals | Diffs для человеческого ревью | Git (после одобрения) |

## 4. Сценарии и карта вызовов

### 4.0. Полная карта триггеров

| # | Триггер | Сценарий | Вызывающий | Процесс KE |
|---|---------|----------|-----------|-------------|
| 1 | Мелкое правило в сессии (1-3 строки) | Claude пишет напрямую | Claude (root/repo) | **Нет** (capture-to-pack) |
| 2 | Исчезающая заметка (.текст в TG) | Бот → inbox → KE | launchd / ручной | Inbox-Check |
| 3 | Inbox по расписанию | Проверка captures | launchd (2-3ч) | Inbox-Check |
| 4 | Закрытие сессии | Сбор всех captures | Claude (root/repo) | Session-Close |
| 5 | Явный запрос пользователя | `/extract`, «запиши в Pack» | Claude (root/repo) | On-Demand |
| 6 | Загрузка документа | Пакетная обработка | Claude (root/repo) | Bulk Extraction |
| 7 | Изменился Pack | Проверка downstream | Claude / git hook | Cross-Repo Sync |
| 8 | Изменилась ontology.md | Синхронизация онтологий | Claude / git hook | Ontology Sync |
| 9 | Периодический аудит | Ревизия Pack'ов | launchd (ежемесячно) | Knowledge Audit |

> **Исключение #1:** Мелкие правила (1-3 строки, одобрены пользователем) — Claude записывает напрямую в CLAUDE.md или memory/, **без вызова Экстрактора**. Это единственный сценарий, который обходит KE. Обоснование: overhead формализации > ценность для правила в 1-3 строки.

### 4.0.1. Архитектура вызывающих

```
                    ┌─────────────┐
                    │  Экстрактор │
                    │  (7 проц.)  │
                    └──────▲──────┘
                           │
          ┌────────────────┼────────────────┐
          │                │                │
    ┌─────┴─────┐   ┌─────┴─────┐   ┌─────┴─────┐
    │  Claude   │   │  launchd  │   │  Событие  │
    │ (сессия)  │   │(расписание)│  │(git hook, │
    │           │   │           │   │ бот)      │
    └─────┬─────┘   └─────┴─────┘   └─────┬─────┘
          │               │               │
    ┌─────┴─────┐   ┌─────┴─────┐   ┌─────┴─────┐
    │• Root     │   │• Inbox-   │   │• Cross-   │
    │  Claude   │   │  Check    │   │  Repo Sync│
    │• Repo     │   │• Knowledge│   │• Ontology │
    │  Claude   │   │  Audit    │   │  Sync     │
    │           │   │           │   │           │
    │Процессы:  │   │           │   │           │
    │ Session-  │   │           │   │           │
    │  Close    │   │           │   │           │
    │ On-Demand │   │           │   │           │
    │ Bulk      │   │           │   │           │
    └───────────┘   └───────────┘   └───────────┘
```

**Claude root** (`~/Github`) — вызывает KE при Close и On-Demand из любого контекста.
**Claude repo** (`<repo>/`) — вызывает KE при Close и On-Demand из контекста репо.
**launchd** — периодический вызов Inbox-Check и Knowledge Audit.
**Событие** — git hook после коммита в Pack запускает Cross-Repo Sync / Ontology Sync.

### 4.1. Session-Close (закрытие сессии)

**Триггер:** Пользователь говорит «закрываю сессию» / РП завершён.
**Вызывающий:** Claude (root или repo) → протокол Close (CLAUDE.md § 2).

**Поток:**
```
Закрытие сессии → KE собирает captures + ищет пропущенные → Extraction Report → Ревью → Pack
```

### 4.2. On-Demand (явный запрос)

**Триггер:** Пользователь явно просит зафиксировать знание: `/extract`, «запиши в Pack».
**Вызывающий:** Claude (root или repo).

**Поток:**
```
Запрос → KE формализует один кандидат → Предложение → Одобрение → Pack
```

### 4.3. Bulk-Extraction (пакетная обработка)

**Триггер:** Пользователь загрузил документ, гайд, пост для обработки.
**Вызывающий:** Claude (root или repo).

**Поток:**
```
Документ → KE анализирует → Отчёт с кандидатами → Ревью → Размещение
```

### 4.4. Cross-Repo-Sync (синхронизация между репо)

**Триггер:** Изменение в Pack → проверка, нужно ли обновить downstream.
**Вызывающий:** Claude / git hook.

**Поток:**
```
Изменение в Pack → KE проверяет downstream → Список предложений → Ревью
```

### 4.5. Knowledge-Audit (аудит знаний)

**Триггер:** По расписанию (monthly) или по запросу.
**Вызывающий:** launchd / пользователь.

**Поток:**
```
Обход всех Pack → Проверка полноты, устаревших записей, битых ссылок → Отчёт
```

### 4.6. Inbox-Check (проверка inbox)

**Триггер:** Расписание (каждые 2-3 часа) или ручной запуск.
**Вызывающий:** launchd / ручной.

**Поток:**
```
inbox/captures.md → KE формализует pending записи → Extraction Report → Notify (→ SYS.016 Синхронизатор) → Одобрение → Pack
```

### 4.7. Ontology-Sync (синхронизация онтологий)

**Триггер:** Изменение ontology.md в любом Pack.
**Вызывающий:** Claude / git hook.

**Поток:**
```
Pack ontology изменилась → KE сравнивает с мастером → Sync Report → Одобрение → Обновление мастера + downstream
```

## 5. Переносимость (отчуждаемость)

> Platform-space ≠ User-space (DP.D.011)

**Platform-space (одинаково для всех):**
- Логика классификации (типы знаний → типы файлов)
- Логика маршрутизации (bounded context → целевой репо)
- Логика формализации (шаблоны SPF)
- Логика валидации (process lint)

**User-space (уникально для пользователя):**
- Список подключённых репозиториев
- Дополнительные правила в CLAUDE.md репо
- Персональные Pack-манифесты
- Пороги чувствительности (как часто предлагать capture)

**Как пользователь подключается:**
1. Указывает свои репо (через GitHub OAuth или конфиг)
2. Экстрактор читает манифесты и CLAUDE.md каждого репо
3. Формирует карту маршрутизации: какое знание куда
4. Работает по общей логике + персональным правилам

## 6. Один или несколько?

**Ответ: ОДНА ИИ-система с несколькими сценариями** (по аналогии со Стратегом, который имеет 8+ сценариев).

**Обоснование:**
- Все сценарии используют одну и ту же тройку: классификация → маршрутизация → формализация
- Различаются только триггеры (реальное время vs пакетный vs по расписанию) и масштаб (один инсайт vs документ vs весь Pack)
- Один config.yaml, один набор промптов, один набор MCP

## 7. Инструменты (MCP, слой 2)

| MCP | Назначение |
|-----|------------|
| pack-MCP (per pack) | Чтение структуры Pack'а, манифестов, bounded contexts |
| user-repos MCP | Чтение/запись файлов в репо пользователя |
| guides-mcp | Нормативные материалы для проверки |
| knowledge-mcp | Индексный поиск по всем БЗ |

## 8. Метрики

| Метрика | Целевое значение |
|---------|-----------------|
| classification_accuracy | >80% (кандидаты правильно классифицированы) |
| routing_accuracy | >90% (попадание в правильный репо/директорию) |
| human_acceptance_rate | >70% (одобренных предложений) |
| false_positive_rate | <20% (ненужных предложений) |

## 9. Реализация (Downstream)

| Репо | Статус | Описание |
|------|--------|----------|
| [DS-extractor-agent](https://github.com/TserenTserenov/DS-extractor-agent) | MVP | Prompt-based реализация: 7 промптов, PROCESSES.md с 7 процессами, автоматизация (launchd). Уведомления делегированы SYS.016 Синхронизатору |

**Архитектура реализации:** Без кода — целиком на промптах Claude Code. Запуск: через Protocol Close, по команде пользователя, по расписанию (launchd), или по событию (git hook).

**Покрытие сценариев:**

| Сценарий (§ 4) | Промпт | Статус |
|-----------------|--------|--------|
| Session-Close (§ 4.1) | `prompts/session-close.md` | Готов к тесту |
| On-Demand (§ 4.2) | `prompts/on-demand.md` | Готов к тесту |
| Bulk-Extraction (§ 4.3) | `prompts/bulk-extraction.md` | Готов к тесту |
| Cross-Repo-Sync (§ 4.4) | `prompts/cross-repo-sync.md` | Готов к тесту |
| Knowledge-Audit (§ 4.5) | `prompts/knowledge-audit.md` | Готов к тесту |
| Inbox-Check (§ 4.6) | `prompts/inbox-check.md` | Работает (launchd 3h) |
| Ontology-Sync (§ 4.7) | `prompts/ontology-sync.md` | Готов к тесту |

## 10. Связанные документы

- [DP.ARCH.001 Архитектура](DP.ARCH.001-platform-architecture.md) — слой 3, IPO-паттерн
- [DP.AGENT.001 ИИ-системы](DP.AGENT.001-ai-agents.md) — реестр, паспорт
- [DP.EXOCORTEX.001 Модульный экзокортекс](DP.EXOCORTEX.001-modular-exocortex.md) — capture-to-pack как примитив
- [DP.M.001 Метод экстракции знаний](../03-methods/DP.M.001-knowledge-extraction.md)
- [DP.WP.001 Отчёт экстракции](../04-work-products/DP.WP.001-extraction-report.md)
- [DP.NAV.001 Навигация знаний](DP.NAV.001-knowledge-navigation.md)
